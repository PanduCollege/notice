<html lang="en" dir="ltr"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notice Board</title>
    <!-- Google fonts. -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css?family=Varela Round" rel="stylesheet">
    
    
    <!-- Use font awesome icons. -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <!-- Use firebase app and database. -->
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
</head>
<style>
  body {
  /* https://www.color-hex.com/color/d3d3d3 */
  background-color: #fff;
  /*#f6f6f6, EBEBD3, fafafa*/
  font-family: Bungee Outline;
  font-weight: 900;
  overflow: hidden;
  animation: blur 0.5s ease-out;
}
* {
  outline: none;
  border: none;
  padding: 0;
  margin: 0;
  box-sizing: border-box;
}
#title_container {
  width: 100%;
  height: 225px;
  display: flex;
  justify-content: center;
  align-items: center;
  background-image: radial-gradient(#0A0819, #2F144C);
  border-bottom: 5px solid #fff;
  box-shadow: 0 0 30px -18px radial-gradient(#0A0819, #2F144C);

}
#title_inner_container {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  /* background-color: #083D77; */
  border-radius: 200px;
}
#title {
  display: inline-block;
  color: #fff;
  /*EBEBD3, C5283D*/
  font-size: 55px;
  letter-spacing: 2px;
  user-select: none;
}
#message {
  display: none;
}
#join_container {
  width: 100%;
  height: 200px;

  display: flex;
  justify-content: center;
  align-items: center;

  float: left;
  margin-top: 80px;

}
#join_inner_container {
  width: 50%;
  height: 100%;
}
#join_input_container {
  width: 100%;
  height: 50px;
  display: flex;
  justify-content: center;
  align-items: center;
  float: left;
}
#join_input {
  width: 60%;
  height: 40px;
  color: #1D3354;
  font-family: Varela Round;
  font-size: 15px;
  font-weight: bold;
  text-align: center;
  background-color: Transparent;
  border-bottom: 2px dashed #1D3354;

}
#join_input:focus {
  box-shadow: 0 10px 30px -17px #1D3354;
}
#join_button_container {
  width: 100%;
  height: 50px;
  display: flex;
  justify-content: center;
  align-items: center;
  float: left;
}
#join_button {
  width: 60%;
  height: 40px;
  font-family: Varela Round;
  font-size: 15px;
  font-weight: bold;
  text-align: center;
  color: orangered;
}
#additional_line_container {
  text-align: center;
  padding-top: 3%;
  color: radial-gradient(#0A0819, #2F144C);
  font-family: 'Lobster', cursive;
}
#chat_container {
  width: 100%;
  height: 60%;
  display: flex;
  justify-content: center;
  float: left;
  margin-top: 40px;
  /* Fade in container */
  animation: fadeIn 1s linear;
}
#chat_inner_container {
  width: 40%;
  height: 100%;
}
#chat_content_container {
  width: 100%;
  height: 90%;
  float: left;
  overflow-y: auto;
  font-family: Varela Round;
  padding-left: 15px;
  padding-right: 15px;
}
@media screen and (max-width:450px) {
  #chat_container {
      width: 100%;
      height: 70%;
      display: flex;
      justify-content: center;
      float: left;
      margin-top: 40px;
      /* Fade in container */
      animation: fadeIn 1s linear;
  }
  #chat_inner_container {
      width: 90%;
      height: 100%;
  }
  #chat_content_container {
      width: 100%;
      height: 90%;
      float: left;
      overflow-y: auto;
      font-family: Varela Round;
      padding-left: 5px;
      padding-right: 5px;
  }
  #additional_line_container {
      font-size: 90%;
  }
}
#chat_input_container {
  width: 100%;
  height: 10%;
  float: left;
  border-bottom: 2px dashed #1D3354;
  background-color: Transparent;
  padding-left: 15px;
  padding-right: 15px;
  font-family: Varela Round;
  margin-top: 10px;
}
#chat_input {
  width: 95%;
  height: 100%;
  float: left;
  background-color: Transparent;
  color: #1D3354;
  font-size: 15px;
}
#chat_input_send {
  width: 5%;
  height: 100%;
  float: left;
  font-size: 18px;
  background-color: transparent;
  text-align: right;
  color: rgb(99, 97, 96);
}


#chat_input_send.enabled {
  color: orangered;
  background-color: Transparent;
  cursor: pointer;

}
#chat_logout_container {
  width: 100%;
  display: inline-block;
  display: flex;
  justify-content: center;
  align-items: center;
  float: left;
  margin-top: 20px;
}
#chat_logout {
  color: orangered;
  cursor: pointer;
}
#chat_logout:hover {
  text-decoration: underline;
}
.message_container {
  width: 100%;
  display: inline-block;
  margin-bottom: 20px;
}
.message_inner_container {
  width: 100%;
  display: inline-block;

  color: #1D3354;
}
.message_user_container {
  width: 100%;
  display: inline-block;
}
.message_user {
  font-weight: bold;
  font-size: 14px;
}
.message_content_container {
  width: 100%;
  display: inline-block;

  white-space: pre-wrap;
  word-wrap: break-word;
}
.message_content {
  font-weight: normal;
  font-size: 14px;
  margin-top: 5px;
}

.enabled {
  transition: background-color 0.5s;
  color: #fff;
  background-color: radial-gradient(#0A0819, #2F144C);
  /*#5B7553;*/
  cursor: pointer;
}
#title_container.chat_title_container {
  transition: 0.8s;
  transition-timing-function: ease-in-out;
  height: 100px;
}
#title.chat_title {
  transition: 0.8s;
  font-size: 47px;
}
.loader_container {
  width: 100%;
  height: 100%;

  display: flex;
  justify-content: center;
  align-items: center;
}
.loader {
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;

  border-top: 6px solid radial-gradient(#0A0819, #2F144C);
  border-bottom: 6px solid #1D3354;
  border-left: 6px solid #E9FFF9;
  border-right: 6px solid #E9FFF9;
}

@keyframes spin {
  0% {
      transform: rotate(0deg);
  }
  100% {
      transform: rotate(360deg);
  }
}
@keyframes fadeIn {
  0% {
      opacity: 0;
  }
  100% {
      opacity: 1;
  }
}
@keyframes blur {
  0% {
      filter: blur(5px);
  }
  100% {}
}
::selection {
  background-color: radial-gradient(#0A0819, #2F144C);
  color: #fff;
}
/* width */
::-webkit-scrollbar {
  width: 6px;
}
/* Track */
::-webkit-scrollbar-track {
  background: white;
}
/* Handle */
::-webkit-scrollbar-thumb {
  background: radial-gradient(#0A0819, #2F144C);
  border-radius: 5px;
}
</style>
<body>
<script>
  // We enclose this in window.onload.
// So we don't have ridiculous errors.
window.onload = function() {
  // Import the functions you need from the SDKs you need
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
apiKey: "AIzaSyCB5DovJQSgU-CdCKM3fTx-02TtUMOXaeY",
authDomain: "bca-clubs.firebaseapp.com",
databaseURL: "https://bca-clubs-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "bca-clubs",
storageBucket: "bca-clubs.appspot.com",
messagingSenderId: "641727500622",
appId: "1:641727500622:web:d570f70e4f364d39548e1f"
};

// Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  // This is very IMPORTANT!! We're going to use "db" a lot.
  var db = firebase.database()
  // We're going to use oBjEcT OrIeNtEd PrOgRaMmInG. Lol
  class NOTICE{
    // Home() is used to create the home page
    home(){
      // First clear the body before adding in
      // a title and the join form
      document.body.innerHTML = ''
      this.create_title()
      this.create_join_form()
    }
    // chat() is used to create the chat page
    chat(){
      this.create_title()
      this.create_chat()
    }
    // create_title() is used to create the title
    create_title(){
      // This is the title creator. ðŸŽ‰
      var title_container = document.createElement('div')
      title_container.setAttribute('id', 'title_container')
      var title_inner_container = document.createElement('div')
      title_inner_container.setAttribute('id', 'title_inner_container')
  
      var title = document.createElement('h1')
      title.setAttribute('id', 'title')
      title.textContent = 'Notice Board'
  
      title_inner_container.append(title)
      title_container.append(title_inner_container)
      document.body.append(title_container)
  
      // Creating a new container for the additional line
      var additional_line_container = document.createElement('div');
      additional_line_container.setAttribute('id', 'additional_line_container');
      var additional_line = document.createElement('p');
      additional_line.textContent = 'The Name Will Be Diplayed Along With The Message';
      additional_line_container.append(additional_line);
      document.body.append(additional_line_container);
  }
  
    // create_join_form() creates the join form
    create_join_form(){
      var parent = this;

      var join_container = document.createElement('div')
      join_container.setAttribute('id', 'join_container')
      var join_inner_container = document.createElement('div')
      join_inner_container.setAttribute('id', 'join_inner_container')

      var join_button_container = document.createElement('div')
      join_button_container.setAttribute('id', 'join_button_container')

      var join_button = document.createElement('button')
      join_button.setAttribute('id', 'join_button')
      join_button.innerHTML = 'Join <i class="fas fa-sign-in-alt"></i>'

      var join_input_container = document.createElement('div')
      join_input_container.setAttribute('id', 'join_input_container')

      var join_input = document.createElement('input')
      join_input.setAttribute('id', 'join_input')
      join_input.setAttribute('maxlength', 50)
      join_input.placeholder = 'Full Name'
      // Every time we type into the join_input
      join_input.onkeyup  = function(){
        // If the input we have is longer that 0 letters
        if(join_input.value.length > 0){
          // Make the button light up
          join_button.classList.add('enabled')
          // Allow the user to click the button
          join_button.onclick = function(){
            // Save the name to local storage. Passing in
            // the join_input.value
            parent.save_name(join_input.value)
            // Remove the join_container. So the site doesn't look weird.
            join_container.remove()
            // parent = this. But it is not the join_button
            // It is (NOTICE = this).
            parent.create_chat()
          }
        }else{
          // If the join_input is empty then turn off the
          // join button
          join_button.classList.remove('enabled')
        }
      }

      // Append everything to the body
      join_button_container.append(join_button)
      join_input_container.append(join_input)
      join_inner_container.append(join_input_container, join_button_container)
      join_container.append(join_inner_container)
      document.body.append(join_container)
    }
    // create_load() creates a loading circle that is used in the chat container
    create_load(container_id){
      // YOU ALSO MUST HAVE (PARENT = THIS). BUT IT'S WHATEVER THO.
      var parent = this;

      // This is a loading function. Something cool to have.
      var container = document.getElementById(container_id)
      container.innerHTML = ''

      var loader_container = document.createElement('div')
      loader_container.setAttribute('class', 'loader_container')

      var loader = document.createElement('div')
      loader.setAttribute('class', 'loader')

      loader_container.append(loader)
      container.append(loader_container)

    }
    
    // create_chat() creates the chat container and stuff
    create_chat() {
var parent = this;
var title_container = document.getElementById('title_container');
var title = document.getElementById('title');
title_container.classList.add('chat_title_container');
title.classList.add('chat_title');

var chat_container = document.createElement('div');
chat_container.setAttribute('id', 'chat_container');

var chat_inner_container = document.createElement('div');
chat_inner_container.setAttribute('id', 'chat_inner_container');

var chat_content_container = document.createElement('div');
chat_content_container.setAttribute('id', 'chat_content_container');

var chat_input_container = document.createElement('div');
chat_input_container.setAttribute('id', 'chat_input_container');

var chat_input_send = document.createElement('button');
chat_input_send.setAttribute('id', 'chat_input_send');
chat_input_send.setAttribute('disabled', true);
chat_input_send.textContent = 'Send';

var chat_input = document.createElement('input'); // Input field for typing
chat_input.setAttribute('id', 'chat_input');
chat_input.setAttribute('maxlength', 1000);
chat_input.placeholder = `${parent.get_name()}. Say something...`;
chat_input.onkeyup = function () {
    if (chat_input.value.length > 0) {
        chat_input_send.removeAttribute('disabled');
        chat_input_send.classList.add('enabled');
        chat_input_send.onclick = function () {
            chat_input_send.setAttribute('disabled', true);
            chat_input_send.classList.remove('enabled');
            if (chat_input.value.length <= 0) {
                return;
            }
            parent.create_load('chat_content_container');
            parent.send_message(chat_input.value);
            chat_input.value = '';
            chat_input.focus();
            var message = document.getElementById("message").value;
          google.script.run.sendEmails(message);
        };
    } else {
        chat_input_send.classList.remove('enabled');
    }
};

var chat_textarea = document.createElement('textarea'); // Text area for displaying messages
chat_textarea.setAttribute('id', 'message'); // Set id to "message"
chat_textarea.setAttribute('readonly', true); // Set it to readonly so users can't type in it
chat_textarea.setAttribute('rows', 10); // Adjust rows/columns as needed

chat_input.addEventListener('input', function() { // Event listener to update text area in real-time
    chat_textarea.value = chat_input.value;
});

var chat_logout_container = document.createElement('div');
chat_logout_container.setAttribute('id', 'chat_logout_container');

var chat_logout = document.createElement('button');
chat_logout.setAttribute('id', 'chat_logout');
chat_logout.textContent = `${parent.get_name()} â€¢ logout`;
chat_logout.onclick = function () {
    localStorage.clear();
    parent.home();
};

chat_logout_container.append(chat_logout);
chat_input_container.append(chat_input, chat_input_send);
chat_inner_container.append(chat_content_container, chat_textarea, chat_input_container, chat_logout_container);
chat_container.append(chat_inner_container);
document.body.append(chat_container);
parent.create_load('chat_content_container');
parent.refresh_chat();
}
   
    // Save name. It literally saves the name to localStorage
    save_name(name){
      // Save name to localStorage
      localStorage.setItem('name', name)
    }
    // Sends message/saves the message to firebase database
    send_message(message){
      var parent = this
      // if the local storage name is null and there is no message
      // then return/don't send the message. The user is somehow hacking
      // to send messages. Or they just deleted the
      // localstorage themselves. But hacking sounds cooler!!
      if(parent.get_name() == null && message == null){
        return
      }

      // Get the firebase database value
      db.ref('chats/').once('value', function(message_object) {
        // This index is mortant. It will help organize the chat in order
        var index = parseFloat(message_object.numChildren()) + 1
        db.ref('chats/' + `message_${index}`).set({
          name: parent.get_name(),
          message: message,
          index: index
        })
        .then(function(){
          // After we send the chat refresh to get the new messages
          parent.refresh_chat()
        })
      })
    }
    // Get name. Gets the username from localStorage
    get_name(){
      // Get the name from localstorage
      if(localStorage.getItem('name') != null){
        return localStorage.getItem('name')
      }else{
        this.home()
        return null
      }
    }
    // Refresh chat gets the message/chat data from firebase
    refresh_chat() {
      var chat_content_container = document.getElementById('chat_content_container');
  
      db.ref('chats/').on('value', function(messages_object) {
          chat_content_container.innerHTML = '';
  
          if(messages_object.numChildren() == 0){
              return;
          }
  
          var messages = Object.values(messages_object.val());
  
          messages.forEach(function(data) {
              var name = data.name;
              var message = data.message;
  
              // Regular expression to detect URLs in the message content
              var urlRegex = /(https?:\/\/[^\s]+)/g;
              // Replace URLs with clickable links
              var formattedMessage = message.replace(urlRegex, function(url) {
                  return '<a href="' + url + '" target="_blank">' + url + '</a>';
              });
  
              var message_container = document.createElement('div');
              message_container.setAttribute('class', 'message_container');
  
              var message_inner_container = document.createElement('div');
              message_inner_container.setAttribute('class', 'message_inner_container');
  
              var message_user_container = document.createElement('div');
              message_user_container.setAttribute('class', 'message_user_container');
  
              var message_user = document.createElement('p');
              message_user.setAttribute('class', 'message_user');
              message_user.textContent = name;
  
              var message_content_container = document.createElement('div');
              message_content_container.setAttribute('class', 'message_content_container');
  
              var message_content = document.createElement('p');
              message_content.setAttribute('class', 'message_content');
              message_content.innerHTML = formattedMessage; // Set the formatted message as HTML
  
              message_user_container.append(message_user);
              message_content_container.append(message_content);
              message_inner_container.append(message_user_container, message_content_container);
              message_container.append(message_inner_container);
  
              chat_content_container.append(message_container);
          });
  
          chat_content_container.scrollTop = chat_content_container.scrollHeight;
      });
  }
  


  }
  // So we've "built" our app. Let's make it work!!
  var app = new NOTICE()
  // If we have a name stored in localStorage.
  // Then use that name. Otherwise , if not.
  // Go to home.
  if(app.get_name() != null){
    app.chat()
  }
}
</script>
</body>
</html>
